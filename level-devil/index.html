<!DOCTYPE html>
<html>
<head>
    <title>ðŸ˜ˆ Level Devil ðŸ˜ˆ</title>
    <link rel="icon" type="image/x-icon" href="https://math.hws.edu/favicon.ico">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }
    </style>
</head>
<body>
    <iframe id="gameFrame" src="https://leveldevil-unblocked.github.io/" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen allow="fullscreen *; autoplay; gamepad"></iframe>

    <script>
        const iframe = document.getElementById('gameFrame');
        const ALLOWED_URLS = [
            'https://leveldevil-unblocked.github.io/',
            'https://leveldevil-unblocked.github.io/#' 
        ];
        const BLOCKED_KEYWORDS = ['securly', 'blocked', 'access denied', 'restricted'];
        let isReloading = false;
        let loadCount = 0;
        let lastCheckTime = Date.now();
        let checkInterval;

        function isAllowedUrl(url) {
            if (!url) return false;
            return ALLOWED_URLS.includes(url);
        }

        function isBlockedUrl(url) {
            if (!url) return false;
            const lowerUrl = url.toLowerCase();
            return BLOCKED_KEYWORDS.some(keyword => lowerUrl.includes(keyword));
        }

        function triggerReload() {
            if (isReloading) return;
            isReloading = true;
            clearInterval(checkInterval);
            setTimeout(() => location.reload(), 2000);
        }

        // Aggressive periodic checking
        function startChecking() {
            checkInterval = setInterval(() => {
                if (isReloading) return;
                
                try {
                    // Try to access iframe
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const currentUrl = iframe.contentWindow.location.href;
                    
                    // If we can access URL and it's not allowed, reload
                    if (currentUrl && !isAllowedUrl(currentUrl)) {
                        triggerReload();
                        return;
                    }
                    
                    // Check if iframe body is empty or contains blocking text
                    const bodyText = iframeDoc.body.innerText.toLowerCase();
                    if (bodyText.includes('securly') || 
                        bodyText.includes('blocked') ||
                        bodyText.includes('access denied') ||
                        iframeDoc.body.innerHTML.length < 50) {
                        triggerReload();
                        return;
                    }
                    
                } catch (e) {
                    // Cross-origin error - likely redirected to different domain
                    // This is the main indicator of blocking
                    triggerReload();
                    return;
                }
                
                // Additional check: try to detect if iframe is "stuck" or blank
                try {
                    const iframeWin = iframe.contentWindow;
                    // If we can't access anything, likely blocked
                    if (!iframeWin || iframeWin.length === undefined) {
                        triggerReload();
                    }
                } catch (e) {
                    triggerReload();
                }
                
            }, 500); // Check every 500ms
        }

        iframe.addEventListener('load', () => {
            loadCount++;
            lastCheckTime = Date.now();
            
            if (loadCount === 1) {
                // Start aggressive checking after initial load
                setTimeout(startChecking, 2000);
            }
            
            if (isReloading) return;
            
            // Immediate check on load
            setTimeout(() => {
                try {
                    const currentUrl = iframe.contentWindow.location.href;
                    if (!isAllowedUrl(currentUrl)) {
                        triggerReload();
                    }
                } catch (e) {
                    // Cross-origin on load event = definitely redirected
                    triggerReload();
                }
            }, 1000);
        });

        // Backup: Monitor title aggressively
        const titleObserver = new MutationObserver(() => {
            if (isReloading) return;
            
            const title = document.title.toLowerCase();
            if (BLOCKED_KEYWORDS.some(keyword => title.includes(keyword)) || 
                title.includes('securly')) {
                triggerReload();
            }
        });
        
        titleObserver.observe(document.querySelector('title'), {
            childList: true,
            subtree: true,
            characterData: true
        });

        // Nuclear option: Force reload if page becomes hidden (some blockers do this)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && !isReloading) {
                setTimeout(() => {
                    if (document.hidden) {
                        triggerReload();
                    }
                }, 1000);
            }
        });

        // Final fallback: Reload after 30 seconds if we haven't confirmed we're on correct page
        setTimeout(() => {
            if (!isReloading && loadCount > 0) {
                try {
                    const currentUrl = iframe.contentWindow.location.href;
                    if (!isAllowedUrl(currentUrl)) {
                        triggerReload();
                    }
                } catch (e) {
                    triggerReload();
                }
            }
        }, 30000);
    </script>
</body>
</html>
