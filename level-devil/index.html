<!DOCTYPE html>
<html>
<head>
    <title>ðŸ˜ˆ Level Devil ðŸ˜ˆ</title>
    <link rel="icon" type="image/x-icon" href="https://math.hws.edu/favicon.ico">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }
    </style>
</head>
<body>
    <iframe id="gameFrame" src="https://leveldevil-unblocked.github.io/" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen allow="fullscreen *; autoplay; gamepad"></iframe>

    <script>
        const iframe = document.getElementById('gameFrame');
        const ORIGINAL_DOMAIN = 'leveldevil-unblocked.github.io';
        let isReloading = false;
        let loadCount = 0;
        let lastUrl = null;

        // Wait for initial load before starting detection
        window.addEventListener('load', () => {
            setTimeout(() => {
                // Store reference to working state
                try {
                    lastUrl = iframe.contentWindow.location.href;
                } catch (e) {
                    // Original site might have restrictions, that's ok
                    lastUrl = ORIGINAL_DOMAIN;
                }
            }, 2000);
        });

        iframe.addEventListener('load', () => {
            loadCount++;
            
            // Skip first load (initial page load)
            if (loadCount <= 1) return;
            
            if (isReloading) return;
            
            // Delay to let page settle
            setTimeout(() => {
                analyzeNavigation();
            }, 2000);
        });

        function analyzeNavigation() {
            if (isReloading) return;
            
            try {
                const currentUrl = iframe.contentWindow.location.href;
                
                // Only reload if we successfully read URL AND it's definitely not our site
                if (currentUrl && 
                    !currentUrl.includes(ORIGINAL_DOMAIN) && 
                    (currentUrl.includes('securly.com') || 
                     currentUrl.includes('blocked') ||
                     currentUrl.includes('securly'))) {
                    
                    isReloading = true;
                    setTimeout(() => location.reload(), 3000);
                }
                // If URL is accessible and contains our domain, we're good - do nothing
                
            } catch (e) {
                // Cross-origin error - could be redirect OR could be original site's CSP
                // Only reload if we previously had access and lost it (confirmed redirect)
                // OR if title changed to indicate blocking
                
                const title = document.title.toLowerCase();
                if (title.includes('securly') || 
                    title.includes('blocked') ||
                    title.includes('access denied')) {
                    
                    isReloading = true;
                    setTimeout(() => location.reload(), 4000);
                }
                // Otherwise, assume it's just CSP on original site - do nothing
            }
        }

        // Only trigger on explicit title changes to blocking keywords
        const titleObserver = new MutationObserver(() => {
            if (isReloading) return;
            
            const title = document.title.toLowerCase();
            // Only reload if title explicitly indicates blocking (not just any change)
            if (title.includes('securly') || 
                title.includes('blocked') || 
                title.includes('access denied') ||
                title.includes('restricted')) {
                
                isReloading = true;
                setTimeout(() => location.reload(), 5000);
            }
        });
        
        // Only start observing after initial load
        setTimeout(() => {
            const titleElement = document.querySelector('title');
            if (titleElement) {
                titleObserver.observe(titleElement, {
                    childList: true,
                    subtree: true,
                    characterData: true
                });
            }
        }, 3000);
    </script>
</body>
</html>
