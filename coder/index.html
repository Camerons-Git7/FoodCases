<script>
    const inputContainer = document.getElementById('input-container');
    const codeInput = document.getElementById('code-input');
    const runBtn = document.getElementById('run-btn');
    const previewContainer = document.getElementById('preview-container');

    function isValidUrl(string) {
        try {
            const url = new URL(string);
            return url.protocol === "http:" || url.protocol === "https:";
        } catch (_) {
            return false;
        }
    }

    function runCode() {
        let code = codeInput.value.trim();

        if (!code) {
            inputContainer.classList.add('animate-pulse');
            setTimeout(() => inputContainer.classList.remove('animate-pulse'), 500);
            return;
        }

        inputContainer.classList.add('fade-out');

        setTimeout(() => {
            inputContainer.style.display = 'none';
            previewContainer.style.display = 'block';

            // Check for socks command
            const socksPrefix = "socks ";
            if (code.toLowerCase().startsWith(socksPrefix)) {
                // Extract URL after "socks "
                const target = code.substring(socksPrefix.length).trim();

                // Validate URL format (add http if missing)
                let urlToProxy;
                if (!target.startsWith("http://") && !target.startsWith("https://")) {
                    urlToProxy = "https://" + target;
                } else {
                    urlToProxy = target;
                }

                // Check if valid URL
                if (isValidUrl(urlToProxy)) {
                    const proxyUrl = `https://socks-proxy-47dh.onrender.com/proxy?url=${encodeURIComponent(urlToProxy)}`;
                    previewContainer.innerHTML = `<iframe id="preview-iframe" src="${proxyUrl}" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation"></iframe>`;
                    return;
                }
            }

            // Otherwise usual URL handling
            if (isValidUrl(code) && !code.includes('<') && !code.includes('>')) {
                previewContainer.innerHTML = `<iframe id="preview-iframe" src="${code}" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation"></iframe>`;
            } else {
                // Treat as HTML code
                document.open();
                document.write(code);
                document.close();
            }

        }, 500);
    }

    runBtn.addEventListener('click', runCode);

    codeInput.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            runCode();
        }
    });

    window.addEventListener('DOMContentLoaded', () => {
        codeInput.focus();
    });
</script>
