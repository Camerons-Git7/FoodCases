<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üê¶ Flappy Bird üê¶</title>
  <link rel="icon" type="image/x-icon" href="https://math.hws.edu/favicon.ico" />

  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      touch-action: manipulation;
      -webkit-font-smoothing: antialiased;
      background: linear-gradient(to bottom, #4ec0ca 0%, #70c5ce 40%, #b7e0e5 100%);
    }

    #game-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    /* Moving ground ‚Äì now controlled 100% by JS for perfect sync */
    #ground {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100vw;
      min-width: 336px;
      height: 112px;
      background-image: url('https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/sprites/base.png');
      background-repeat: repeat-x;
      background-size: auto 100%;
      z-index: 30;
      pointer-events: none;
    }

    #bird {
      position: absolute;
      width: 34px;
      height: 24px;
      left: 10%;
      top: 40%;
      z-index: 50;
      transform-origin: center center;
      user-select: none;
      pointer-events: none;
    }

    #bird img {
      width: 100%;
      height: 100%;
      display: block;
      user-select: none;
      pointer-events: none;
    }

    .pipe {
      position: absolute;
      width: 52px;
      user-select: none;
      pointer-events: none;
      z-index: 40;
    }

    .pipe img {
      width: 100%;
      height: 100%;
      display: block;
      user-select: none;
      pointer-events: none;
    }

    .pipe-top {
      transform: rotate(180deg);
      transform-origin: center;
    }

    #score-display {
      position: absolute;
      top: 10%;
      width: 100%;
      text-align: center;
      font-size: 50px;
      color: white;
      text-shadow: 3px 3px 0 #000;
      z-index: 100;
      pointer-events: none;
      user-select: none;
      font-weight: bold;
    }

    #highscore-display {
      position: absolute;
      top: 4%;
      width: 100%;
      text-align: center;
      font-size: 20px;
      color: #ffd700;
      text-shadow: 2px 2px 0 #000;
      z-index: 100;
      pointer-events: none;
      user-select: none;
      font-weight: bold;
    }

    #game-over-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 110;
      color: white;
      text-align: center;
      user-select: none;
    }

    #game-over-text {
      color: #e74c3c;
      font-size: 60px;
      font-weight: bold;
      margin-bottom: 10px;
      text-shadow: 3px 3px 0 #fff;
    }

    #final-score-text {
      font-size: 28px;
      margin-bottom: 20px;
      text-shadow: 2px 2px 0 #000;
    }

    #final-highscore-text {
      font-size: 24px;
      margin-bottom: 30px;
      color: #ffd700;
      text-shadow: 2px 2px 0 #000;
    }

    #restart-btn {
      padding: 15px 30px;
      font-size: 24px;
      background-color: #f1c40f;
      border: 3px solid #000;
      cursor: pointer;
      border-radius: 8px;
      font-weight: bold;
      text-transform: uppercase;
      box-shadow: 0 4px 0 #c0392b;
    }

    #restart-btn:active {
      transform: translateY(4px);
      box-shadow: none;
    }

    #start-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 120;
      color: white;
      font-family: 'Arial', sans-serif;
      user-select: none;
    }

    #start-text {
      font-size: 64px;
      font-weight: bold;
      margin-bottom: 40px;
      text-shadow: 3px 3px 0 #000;
    }

    #play-btn {
      padding: 20px 50px;
      font-size: 28px;
      font-weight: bold;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background-color: #f1c40f;
      color: #000;
      box-shadow: 0 5px 0 #c39b0f;
      text-transform: uppercase;
    }

    #play-btn:active {
      transform: translateY(5px);
      box-shadow: none;
    }
  </style>
</head>

<body>
  <div id="game-container">

    <div id="start-screen">
      <div id="start-text">üê¶ Flappy Bird üê¶</div>
      <button id="play-btn">Play</button>
    </div>

    <div id="score-display">0</div>
    <div id="highscore-display">Highscore: 0</div>

    <div id="bird" aria-label="Flappy Bird">
      <img src="https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/sprites/yellowbird-midflap.png" alt="Flappy Bird" />
    </div>

    <div id="ground" aria-hidden="true"></div>

    <div id="game-over-screen" role="dialog" aria-modal="true" aria-labelledby="game-over-text">
      <div id="game-over-text">GAME OVER</div>
      <div id="final-score-text">Score: 0</div>
      <div id="final-highscore-text">Highscore: 0</div>
      <button id="restart-btn">Play Again</button>
    </div>
  </div>

  <script>
    const bird = document.getElementById('bird');
    const gameContainer = document.getElementById('game-container');
    const gameOverScreen = document.getElementById('game-over-screen');
    const restartBtn = document.getElementById('restart-btn');
    const scoreDisplay = document.getElementById('score-display');
    const highscoreDisplay = document.getElementById('highscore-display');
    const finalScoreText = document.getElementById('final-score-text');
    const finalHighscoreText = document.getElementById('final-highscore-text');
    const startScreen = document.getElementById('start-screen');
    const playBtn = document.getElementById('play-btn');
    const ground = document.getElementById('ground');

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // MAIN SPEED CONTROL ‚Äì pipes @ 6.2 + ground perfectly synced
    let GAME_SPEED = 8;
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    // Highscore
    let highscore = parseInt(localStorage.getItem('flappyBirdHighscore')) || 0;
    highscoreDisplay.innerText = `Highscore: ${highscore}`;

    // Game variables
    let birdY;
    let birdVelocity = 0;
    const gravity = 0.4;
    const jumpStrength = -7;
    let isGameOver = false;
    let score = 0;
    let gameLoop;
    let pipeGenerator;
    let groundOffset = 0;  // ‚Üê NEW: for JS-controlled ground scroll

    const PIPE_GAP = 170;
    const PIPE_WIDTH = 52;
    const pipeSpawnRate = 1800;
    const GROUND_TILE_WIDTH = 336;

    // Bird position
    let birdX;
    function updateBirdX() {
      birdX = gameContainer.clientWidth * 0.1;
      bird.style.left = birdX + 'px';
    }

    function startGame() {
      const containerHeight = gameContainer.clientHeight;
      birdY = containerHeight * 0.4;
      birdVelocity = 0;
      isGameOver = false;
      score = 0;
      GAME_SPEED = 8;  // Reset speed
      groundOffset = 0;
      ground.style.backgroundPosition = '0px 0';
      scoreDisplay.innerText = '0';
      highscoreDisplay.innerText = `Highscore: ${highscore}`;
      gameOverScreen.style.display = 'none';

      document.querySelectorAll('.pipe').forEach(p => p.remove());

      updateBirdX();
      bird.style.top = birdY + 'px';
      bird.style.transform = 'rotate(0deg)';

      clearInterval(gameLoop);
      clearInterval(pipeGenerator);

      gameLoop = setInterval(updateGame, 20);
      pipeGenerator = setInterval(createPipe, pipeSpawnRate);
    }

    function jump() {
      if (isGameOver) return;
      birdVelocity = jumpStrength;
    }

    function createPipe() {
      if (isGameOver) return;

      const groundHeight = 112;
      const availableHeight = gameContainer.clientHeight - groundHeight;

      const minPipeHeight = 50;
      const maxTopPipeHeight = availableHeight - PIPE_GAP - minPipeHeight;
      const pipeHeightTop = Math.floor(Math.random() * (maxTopPipeHeight - minPipeHeight + 1)) + minPipeHeight;

      const spawnX = gameContainer.clientWidth;

      // Top pipe
      const pipeTop = document.createElement('div');
      pipeTop.classList.add('pipe', 'pipe-top');
      pipeTop.style.height = pipeHeightTop + 'px';
      pipeTop.style.left = spawnX + 'px';
      pipeTop.innerHTML = `<img src="https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/sprites/pipe-green.png" alt="pipe">`;

      // Bottom pipe
      const pipeBottomHeight = availableHeight - pipeHeightTop - PIPE_GAP;
      const pipeBottom = document.createElement('div');
      pipeBottom.classList.add('pipe');
      pipeBottom.style.height = pipeBottomHeight + 'px';
      pipeBottom.style.bottom = groundHeight + 'px';
      pipeBottom.style.left = spawnX + 'px';
      pipeBottom.innerHTML = `<img src="https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/sprites/pipe-green.png" alt="pipe">`;

      gameContainer.appendChild(pipeTop);
      gameContainer.appendChild(pipeBottom);

      pipeTop.passed = false;
    }

    function updateGame() {
      const containerHeight = gameContainer.clientHeight;
      const groundHeight = 112;

      // Bird physics
      birdVelocity += gravity;
      birdY += birdVelocity;

      if (birdY <= 0) {
        birdY = 0;
        birdVelocity = 0;
      }

      if (birdY + bird.clientHeight >= containerHeight - groundHeight) {
        birdY = containerHeight - groundHeight - bird.clientHeight;
        endGame();
      }

      bird.style.top = birdY + 'px';

      // Bird rotation
      const rotation = Math.min(Math.max(birdVelocity * 4, -30), 90);
      bird.style.transform = `rotate(${rotation}deg)`;

      const birdRect = bird.getBoundingClientRect();

      // Pipes: move, collide, score
      document.querySelectorAll('.pipe').forEach(pipe => {
        let left = parseFloat(pipe.style.left) || 0;
        left -= GAME_SPEED;
        pipe.style.left = left + 'px';

        const pipeRect = pipe.getBoundingClientRect();

        if (pipeRect.right < 0) {
          pipe.remove();
          return;
        }

        // Collision
        const padding = 2;
        if (
          birdRect.left   + padding < pipeRect.right  &&
          birdRect.right  - padding > pipeRect.left   &&
          birdRect.top    + padding < pipeRect.bottom &&
          birdRect.bottom - padding > pipeRect.top
        ) {
          endGame();
        }

        // Score
        if (pipe.classList.contains('pipe-top') && !pipe.passed) {
          if (pipeRect.right < birdRect.left) {
            score++;
            scoreDisplay.innerText = score;
            pipe.passed = true;

            if (score > highscore) {
              highscore = score;
              localStorage.setItem('flappyBirdHighscore', highscore);
              highscoreDisplay.innerText = `Highscore: ${highscore}`;
            }

            if (score % 5 === 0) GAME_SPEED += 0.25;
          }
        }
      });

      // ‚Üê FIXED: Ground scrolls perfectly in sync with pipes
      groundOffset -= GAME_SPEED;
      if (groundOffset <= -GROUND_TILE_WIDTH) {
        groundOffset += GROUND_TILE_WIDTH;
      }
      ground.style.backgroundPosition = `${groundOffset}px 0`;
    }

    function endGame() {
      if (isGameOver) return;
      isGameOver = true;
      clearInterval(gameLoop);
      clearInterval(pipeGenerator);
      bird.style.transform = `rotate(90deg)`;

      finalScoreText.innerText = `Score: ${score}`;
      finalHighscoreText.innerText = `Highscore: ${highscore}`;
      gameOverScreen.style.display = 'flex';
    }

    // Controls
    document.addEventListener('keydown', e => {
      if (e.code === 'Space' || e.code === 'ArrowUp') {
        e.preventDefault();
        jump();
      }
    });

    document.addEventListener('touchstart', e => {
      e.preventDefault();
      jump();
    }, { passive: false });

    document.addEventListener('mousedown', jump);

    restartBtn.addEventListener('click', e => {
      e.stopPropagation();
      startGame();
    });

    playBtn.addEventListener('click', () => {
      startScreen.style.display = 'none';
      startGame();
    });

    window.addEventListener('resize', () => {
      updateBirdX();
    });

    // Init
    updateBirdX();
    scoreDisplay.innerText = '0';
    startScreen.style.display = 'flex';
  </script>
</body>
</html>
